//See here for an overview of all RPi images: http://elinux.org/RPi_Distributions
//http://dietpi.com/
//Flash image on microSD card with Win32DiskImager

//ssh into Raspberry Pi
ssh root@192.168.1.12

cd /home
mkdir asterisk
sudo chown ubuntu:ubuntu /home/asterisk -R

//Copy asterisk and install_prereq to /home/asterisk. These files are stored on Google Drive.

//run script install_prereq
cd /home/asterisk
chmod 777 install_prereq
./install_prereq install

//Continue installation
./install_prereq install-unpackaged

//Install Asterisk
//wget https://downloads.asterisk.org/pub/telephony/asterisk/asterisk-14-current.tar.gz
//wget https://downloads.asterisk.org/pub/telephony/asterisk/old-releases/asterisk-11.25.3.tar.gz
cd /home/asterisk
tar -zxvf asterisk-14-current.tar.gz
cd asterisk-14.4.1
./configure --with-pjproject-bundled
make
make install
make samples
make config

//Start asterisk
service asterisk start
asterisk -rvvvvv

//Install openvpn
apt-get install openvpn -y

//Install htop
apt-get install htop -y

//Install Midnight Commander
apt-get install mc -y

//Install mailx
apt install mailutils -y

//Install postfix
apt-get install postfix -y

//Change email's sender address
nano /etc/postfix/main.cf
//Add this to main.cf: smtp_generic_maps = hash:/etc/postfix/generic
//Save and close main.cf

nano /etc/postfix/generic
//Add this to generic: root@dietpi info@rofem.nl
//Save and close generic
postmap /etc/postfix/generic
postfix reload

//change name sender address
nano /etc/passwd
//Add these lines add the bottom
root:x:0:0:Rofem:/root:/bin/bash
www-data:x:33:33:Rofem:/var/www:/usr/bin/nologin
//Comment out these lines
#root:x:0:0:root:/root:/bin/bash
#www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin

//Or install sendemail
sudo apt-get install sendemail

//Install and configure dnsmasq for local DNS chaching (https://help.ubuntu.com/community/Dnsmasq)
sudo apt-get install dnsmasq -y
sudo apt-get install dnsutils -y
nano /etc/dnsmasq.conf
Change #listen-address= to listen-address=127.0.0.1
nano /etc/dhcp/dhclient.conf

Make sure config looks like this
#supersede domain-name "fugue.com home.vix.com";
prepend domain-name-servers 127.0.0.1;
request subnet-mask, broadcast-address, time-offset, routers,
domain-name, domain-name-servers, host-name,
netbios-name-servers, netbios-scope;

sudo /etc/init.d/dnsmasq restart
dig ubuntu.com //Query time: 117 msec
dig ubuntu.com //Query time: 1 msec

//Enable wireless network
dietpi-config
7 Network Options: Adapters
Wifi Change Wireless Network Settings

//Turn on wireless card
ifconfig wlan0

//To coneect to a wireless network through the command line do this
iwconfig wlan0 essid name key
//Replace name with the actual network name, and replace password with the actual security key for the network

//Upload email bestanden
scp ~/Documents/Asterisk/email\ files/m2mob.sh root@192.168.1.2:/var/lib/asterisk/agi-bin/
scp ~/Documents/Asterisk/email\ files/ma2mob.sh root@192.168.1.2:/var/lib/asterisk/agi-bin/
scp ~/Documents/Asterisk/email\ files/mmp3.sh root@192.168.1.2:/var/lib/asterisk/agi-bin/

//assign all rights to root user
chmod -R 777 /var/lib/asterisk/agi-bin/

//Send out a test email (the email might end up in the spam folder)
echo "text body" | mailx -s "subject text" roybout@gmail.com

//upload www folder
scp -r ~/Downloads/www root@192.168.1.2:/var
chmod -R 777 /var/www

//Install web server
sudo apt-get install lighttpd

//Restart Asterisk nadat openvpn een verbinding tot stand heeft gebracht
//Voeg deze twee regels toe aan openvpn client config bestand
script-security 2
up /etc/openvpn/up.sh
nano /etc/openvpn/up.sh
//kopieer onderstaande
#!/bin/bash
asterisk -rx "core restart now"
//sla bestand op
chmod +x /etc/openvpn/up.sh

//Remove the installation files
rm -r /home/asterisk
